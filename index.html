<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­æ•°å­—å’Œé‡è¯ç»ƒä¹ </title>
    <style>
        body {
            font-family: 'Arial', 'Meiryo', 'Hiragino Kaku Gothic ProN', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f7ff;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .quiz-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        #questionArea {
            font-size: 2.5em; /* æ›´å¤§çš„å­—å·ä»¥ä¾¿çœ‹æ¸…é¢˜ç›® */
            color: #0056b3;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #e9f5ff;
            border-radius: 8px;
            min-height: 60px; /* ç¡®ä¿æœ‰è¶³å¤Ÿé«˜åº¦ */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #answerInput {
            width: calc(100% - 22px); /* å‡å»paddingå’Œborder */
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1.2em;
            box-sizing: border-box;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 5px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
        }

        #checkButton {
            background-color: #28a745;
        }
        #checkButton:hover {
            background-color: #1e7e34;
        }

        #feedbackArea {
            margin-top: 20px;
            font-size: 1.1em;
            min-height: 30px; /* ç¡®ä¿æœ‰è¶³å¤Ÿé«˜åº¦ */
            font-weight: bold;
        }

        .correct {
            color: #28a745;
        }

        .incorrect {
            color: #dc3545;
        }

        #scoreArea {
            margin-top: 25px;
            font-size: 1.2em;
            color: #555;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .quiz-container {
                padding: 20px;
            }
            h1 {
                font-size: 1.5em;
            }
            #questionArea {
                font-size: 2em;
            }
            #answerInput, button {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>æ—¥è¯­æ•°å­—å’Œé‡è¯ç»ƒä¹ </h1>
        <div id="questionArea"></div>
        <input type="text" id="answerInput" placeholder="è¯·è¾“å…¥è¯»éŸ³ (å¹³å‡å)">
        <button id="checkButton">æ£€æŸ¥ç­”æ¡ˆ</button>
        <button id="nextButton">ä¸‹ä¸€ä¸ª</button>
        <div id="feedbackArea"></div>
        <div id="scoreArea">åˆ†æ•°: <span id="score">0</span></div>
    </div>

    <script>
        // --- æ•°æ®å®šä¹‰åŒº ---
        const standardNumberReadings = {
            '1': 'ã„ã¡', '2': 'ã«', '3': 'ã•ã‚“', '4': 'ã‚ˆã‚“', '5': 'ã”', '6': 'ã‚ã', '7': 'ãªãª', '8': 'ã¯ã¡', '9': 'ãã‚…ã†', '0': ''
        };
        const numberToKanji = { // ä¸»è¦ç”¨äºä¸ªä½æ•°
            '0': 'é›¶', '1': 'ä¸€', '2': 'äºŒ', '3': 'ä¸‰', '4': 'å››', '5': 'äº”', '6': 'å…­', '7': 'ä¸ƒ', '8': 'å…«', '9': 'ä¹',
            '10': 'å', // '10' åŠä»¥ä¸Šä¸»è¦ç”¨äºé‡è¯ç»„åˆä¸­çš„æ•°å­—éƒ¨åˆ†æ˜¾ç¤ºï¼Œå¤æ‚æ•°å­—è½¬æ¢æœ‰ä¸“é—¨é€»è¾‘
            '11':'åä¸€', '12':'åäºŒ', '13':'åä¸‰', '14':'åå››', '15':'åäº”', '16':'åå…­', '17':'åä¸ƒ', '18':'åå…«', '19':'åä¹', '20':'äºŒå'

        };

        // --- å¤æ‚æ•°å­—è½¬æ¢å‡½æ•° ---
        /**
         * å°†æ•°å­—è½¬æ¢ä¸ºæ—¥è¯­çš„ç®€å•å½¢å¼ï¼ˆç”¨äºæ„æˆæ›´å¤§æ•°å­—çš„å‰ç¼€ï¼Œå¦‚ äºŒåä¸‰ä¸‡ ä¸­çš„ äºŒåä¸‰ï¼‰
         * @param {number} n_simple - è¦è½¬æ¢çš„æ•°å­— (é€šå¸¸ < 10000)
         * @returns {{kanji: string, reading: string}}
         */
        function numToJapaneseSimple(n_simple) {
            if (n_simple === 0) return { kanji: "", reading: "" };
            let k_simple = "";
            let r_simple = "";

            // åƒã®ä½ (å¤„ç†ç±»ä¼¼ 123ä¸‡ ä¸­çš„ 123)
            if (n_simple >= 1000) {
                const sen_s = Math.floor(n_simple / 1000);
                if (sen_s === 1 && (k_simple === "" && n_simple < 2000) ) { // 1000-1999, e.g. åƒ for 1000
                    k_simple += "åƒ";
                } else {
                    k_simple += (numberToKanji[String(sen_s)] || String(sen_s)) + "åƒ";
                }

                if (sen_s === 3) r_simple += "ã•ã‚“ãœã‚“";
                else if (sen_s === 8) r_simple += "ã¯ã£ã›ã‚“";
                else if (sen_s === 1) r_simple += "ã›ã‚“";
                else r_simple += (standardNumberReadings[String(sen_s)] || String(sen_s)) + "ã›ã‚“";
                n_simple %= 1000;
            }
            // ç™¾ã®ä½
            if (n_simple >= 100) {
                const hyaku_s = Math.floor(n_simple / 100);
                 if (hyaku_s === 1 && (k_simple === "" || k_simple.endsWith("åƒ")) && n_simple < 200 && (n_simple+1000*(Math.floor(arguments[0]/1000))) < 20000 ) { // 100-199, e.g. ç™¾ for 100, åƒç™¾ for 1100
                    k_simple += "ç™¾";
                } else {
                    k_simple += (numberToKanji[String(hyaku_s)] || String(hyaku_s)) + "ç™¾";
                }

                if (hyaku_s === 1) r_simple += "ã²ã‚ƒã";
                else if (hyaku_s === 3) r_simple += "ã•ã‚“ã³ã‚ƒã";
                else if (hyaku_s === 6) r_simple += "ã‚ã£ã´ã‚ƒã";
                else if (hyaku_s === 8) r_simple += "ã¯ã£ã´ã‚ƒã";
                else r_simple += (standardNumberReadings[String(hyaku_s)] || String(hyaku_s)) + "ã²ã‚ƒã";
                n_simple %= 100;
            }
            // åã®ä½
            if (n_simple >= 10) {
                const juu_s = Math.floor(n_simple / 10);
                if (juu_s === 1) { // ä¿®æ”¹æ¡ä»¶åˆ¤æ–­
                    k_simple += "å";
                } else {
                    k_simple += (numberToKanji[String(juu_s)] || String(juu_s)) + "å";
                }
                if (juu_s === 1) r_simple += "ã˜ã‚…ã†";
                else r_simple += (standardNumberReadings[String(juu_s)] || String(juu_s)) + "ã˜ã‚…ã†";
                n_simple %= 10;
            }
            // ä¸€ã®ä½
            if (n_simple > 0) {
                k_simple += numberToKanji[String(n_simple)] || String(n_simple);
                r_simple += standardNumberReadings[String(n_simple)] || String(n_simple);
            }
            return { kanji: k_simple, reading: r_simple };
        }

        /**
         * å°†æ•°å­—è½¬æ¢ä¸ºå®Œæ•´çš„æ—¥è¯­æ±‰å­—å’Œè¯»éŸ³
         * @param {number} num - è¦è½¬æ¢çš„æ•°å­—
         * @returns {{kanji: string, reading: string}}
         */
        function numToJapanese(num) {
            if (num === 0) return { kanji: "é›¶", reading: "ã‚Œã„" }; // Or ã‚¼ãƒ­
            if (num > 99999999) return {kanji: "å¤ªå¤§æ— æ³•è½¬æ¢", reading: "å¤ªå¤§æ— æ³•è½¬æ¢"}; // ç®€å•ä¸Šé™

            let k = "";
            let r = "";

            // å„„ã®ä½ (å¯é€‰ï¼Œå¦‚æœéœ€è¦æ›´å¤§æ•°å­—)
            // if (num >= 100000000) {
            //     const oku = Math.floor(num / 100000000);
            //     const okuParts = numToJapaneseSimple(oku);
            //     k += okuParts.kanji + "å„„";
            //     r += okuParts.reading + "ãŠã";
            //     num %= 100000000;
            //     if (num === 0) return { kanji: k, reading: r };
            // }


            // ä¸‡ã®ä½
            if (num >= 10000) {
                const manVal = Math.floor(num / 10000);
                const manParts = numToJapaneseSimple(manVal); // å¤„ç†å¦‚ "äºŒåä¸‰"ä¸‡ ä¸­çš„ "äºŒåä¸‰"
                k += manParts.kanji + "ä¸‡";
                r += manParts.reading + "ã¾ã‚“";
                num %= 10000;
                if (num === 0) return { kanji: k, reading: r }; // å¦‚ï¼šä¸€ä¸‡ã€äºŒåä¸‰ä¸‡
            }

            // åƒã®ä½
            if (num >= 1000) {
                const senVal = Math.floor(num / 1000);
                // Kanji: "åƒ" for 1000, "ä¸€åƒ" is not standard unless for emphasis or specific contexts.
                // "äºŒåƒ", "ä¸‰åƒ" etc.
                // If k is not empty (e.g., "ä¸€ä¸‡"), then "ä¸€ä¸‡åƒ" (11000) is correct.
                if (senVal === 1 && !(k.length > 0 && k.endsWith("ä¸‡"))) { // 1000-1999, standalone
                    k += "åƒ";
                } else if (senVal > 0) { // Handles senVal=1 if k already has "ä¸‡" (e.g. ä¸€ä¸‡åƒ)
                    k += (numberToKanji[String(senVal)] || String(senVal)) + "åƒ";
                }


                if (senVal > 0) { // Only add reading if senVal is not zero
                    if (senVal === 3) r += "ã•ã‚“ãœã‚“";
                    else if (senVal === 8) r += "ã¯ã£ã›ã‚“";
                    // Note: 1000 is ã›ã‚“. ã„ã£ã›ã‚“ is typically with counters.
                    // 11000 (ã„ã¡ã¾ã‚“ã›ã‚“), 21000 (ã«ã¾ã‚“ã›ã‚“)
                    else if (senVal === 1) r += "ã›ã‚“";
                    else r += (standardNumberReadings[String(senVal)] || String(senVal)) + "ã›ã‚“";
                }
                num %= 1000;
                if (num === 0 && k.length > 0) return { kanji: k, reading: r };
            }

            // ç™¾ã®ä½
            if (num >= 100) {
                const hyakuVal = Math.floor(num / 100);
                if (hyakuVal === 1 && !(k.length > 0 && (k.endsWith("ä¸‡") || k.endsWith("åƒ")))) { // 100-199, standalone or after non-ä¸‡/åƒ
                     k += "ç™¾";
                } else if (hyakuVal > 0) {
                     k += (numberToKanji[String(hyakuVal)] || String(hyakuVal)) + "ç™¾";
                }


                if (hyakuVal > 0) {
                    if (hyakuVal === 1) r += "ã²ã‚ƒã"; // 100 is ã²ã‚ƒã, not ã„ã¡ã²ã‚ƒã
                    else if (hyakuVal === 3) r += "ã•ã‚“ã³ã‚ƒã";
                    else if (hyakuVal === 6) r += "ã‚ã£ã´ã‚ƒã";
                    else if (hyakuVal === 8) r += "ã¯ã£ã´ã‚ƒã";
                    else r += (standardNumberReadings[String(hyakuVal)] || String(hyakuVal)) + "ã²ã‚ƒã";
                }
                num %= 100;
                if (num === 0 && k.length > 0) return { kanji: k, reading: r };
            }

            // åã®ä½
            if (num >= 10) {
                const juuVal = Math.floor(num / 10);
                 if (juuVal === 1 && !(k.length > 0 && (k.endsWith("ä¸‡") || k.endsWith("åƒ") || k.endsWith("ç™¾")))) {
                     k += "å";
                 } else if (juuVal > 0) {
                     k += (numberToKanji[String(juuVal)] || String(juuVal)) + "å";
                 }

                if (juuVal > 0) {
                    if (juuVal === 1) r += "ã˜ã‚…ã†"; // 10 is ã˜ã‚…ã†, not ã„ã¡ã˜ã‚…ã†
                    else r += (standardNumberReadings[String(juuVal)] || String(juuVal)) + "ã˜ã‚…ã†";
                }
                num %= 10;
                if (num === 0 && k.length > 0) return { kanji: k, reading: r };
            }

            // ä¸€ã®ä½
            if (num > 0) {
                k += numberToKanji[String(num)] || String(num);
                r += standardNumberReadings[String(num)] || String(num);
            }
            return { kanji: k, reading: r };
        }


        const quizData = [
            // --- ç™¾ä½ ---
            { type: 'standalone_number', unit: 'ç™¾', values: [
                { num: 100, q: 'ç™¾', a: 'ã²ã‚ƒã' }, { num: 200, q: 'äºŒç™¾', a: 'ã«ã²ã‚ƒã' },
                { num: 300, q: 'ä¸‰ç™¾', a: 'ã•ã‚“ã³ã‚ƒã' }, { num: 400, q: 'å››ç™¾', a: 'ã‚ˆã‚“ã²ã‚ƒã' },
                { num: 500, q: 'äº”ç™¾', a: 'ã”ã²ã‚ƒã' }, { num: 600, q: 'å…­ç™¾', a: 'ã‚ã£ã´ã‚ƒã' },
                { num: 700, q: 'ä¸ƒç™¾', a: 'ãªãªã²ã‚ƒã' }, { num: 800, q: 'å…«ç™¾', a: 'ã¯ã£ã´ã‚ƒã' },
                { num: 900, q: 'ä¹ç™¾', a: 'ãã‚…ã†ã²ã‚ƒã' }
            ]},
            // --- åƒä½ ---
            { type: 'standalone_number', unit: 'åƒ', values: [
                { num: 1000, q: 'åƒ', a: 'ã›ã‚“' }, { num: 2000, q: 'äºŒåƒ', a: 'ã«ã›ã‚“' },
                { num: 3000, q: 'ä¸‰åƒ', a: 'ã•ã‚“ãœã‚“' }, { num: 4000, q: 'å››åƒ', a: 'ã‚ˆã‚“ã›ã‚“' },
                { num: 5000, q: 'äº”åƒ', a: 'ã”ã›ã‚“' }, { num: 6000, q: 'å…­åƒ', a: 'ã‚ãã›ã‚“' },
                { num: 7000, q: 'ä¸ƒåƒ', a: 'ãªãªã›ã‚“' }, { num: 8000, q: 'å…«åƒ', a: 'ã¯ã£ã›ã‚“' },
                { num: 9000, q: 'ä¹åƒ', a: 'ãã‚…ã†ã›ã‚“' }
            ]},
            // --- å¤æ‚æ•°å­— ---
            {
                type: 'complex_number',
                displayName: 'å¤æ‚æ•°å­—',
                range: [101, 99999], // ä¾‹å¦‚ 101 åˆ° 99999
                generator: function(num) {
                    const japaneseParts = numToJapanese(num);
                    return {
                        q: String(num), // é—®é¢˜æ˜¯é˜¿æ‹‰ä¼¯æ•°å­—
                        a: japaneseParts.reading, // ç­”æ¡ˆæ˜¯è¯»éŸ³
                        kanji_representation: japaneseParts.kanji // ç”¨äºåé¦ˆä¸­æ˜¾ç¤ºæ±‰å­—
                    };
                }
            },
            // --- æœˆ (ãŒã¤) ---
            { type: 'number_counter', counterKanji: 'æœˆ', items: [
                { num: 1, numKanji: 'ä¸€', qSuffix: 'æœˆ', a: 'ã„ã¡ãŒã¤' }, { num: 2, numKanji: 'äºŒ', qSuffix: 'æœˆ', a: 'ã«ãŒã¤' },
                { num: 3, numKanji: 'ä¸‰', qSuffix: 'æœˆ', a: 'ã•ã‚“ãŒã¤' }, { num: 4, numKanji: 'å››', qSuffix: 'æœˆ', a: 'ã—ãŒã¤' },
                { num: 5, numKanji: 'äº”', qSuffix: 'æœˆ', a: 'ã”ãŒã¤' }, { num: 6, numKanji: 'å…­', qSuffix: 'æœˆ', a: 'ã‚ããŒã¤' },
                { num: 7, numKanji: 'ä¸ƒ', qSuffix: 'æœˆ', a: 'ã—ã¡ãŒã¤' }, { num: 8, numKanji: 'å…«', qSuffix: 'æœˆ', a: 'ã¯ã¡ãŒã¤' },
                { num: 9, numKanji: 'ä¹', qSuffix: 'æœˆ', a: 'ããŒã¤' }, { num: 10, numKanji: 'å', qSuffix: 'æœˆ', a: 'ã˜ã‚…ã†ãŒã¤' },
                { num: 11, numKanji: 'åä¸€', qSuffix: 'æœˆ', a: 'ã˜ã‚…ã†ã„ã¡ãŒã¤' }, { num: 12, numKanji: 'åäºŒ', qSuffix: 'æœˆ', a: 'ã˜ã‚…ã†ã«ãŒã¤' }
            ]},
            // --- æ—¥ (ã«ã¡/ã‹) ---
            { type: 'number_counter', counterKanji: 'æ—¥', items: [
                { num: 1, numKanji: 'ä¸€', qSuffix: 'æ—¥', a: 'ã¤ã„ãŸã¡' }, { num: 2, numKanji: 'äºŒ', qSuffix: 'æ—¥', a: 'ãµã¤ã‹' },
                { num: 3, numKanji: 'ä¸‰', qSuffix: 'æ—¥', a: 'ã¿ã£ã‹' }, { num: 4, numKanji: 'å››', qSuffix: 'æ—¥', a: 'ã‚ˆã£ã‹' },
                { num: 5, numKanji: 'äº”', qSuffix: 'æ—¥', a: 'ã„ã¤ã‹' }, { num: 6, numKanji: 'å…­', qSuffix: 'æ—¥', a: 'ã‚€ã„ã‹' },
                { num: 7, numKanji: 'ä¸ƒ', qSuffix: 'æ—¥', a: 'ãªã®ã‹' }, { num: 8, numKanji: 'å…«', qSuffix: 'æ—¥', a: 'ã‚ˆã†ã‹' },
                { num: 9, numKanji: 'ä¹', qSuffix: 'æ—¥', a: 'ã“ã“ã®ã‹' }, { num: 10, numKanji: 'å', qSuffix: 'æ—¥', a: 'ã¨ãŠã‹' },
                { num: 14, numKanji: 'åå››', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã‚ˆã£ã‹' }, { num: 20, numKanji: 'äºŒå', qSuffix: 'æ—¥', a: 'ã¯ã¤ã‹' },
                { num: 24, numKanji: 'äºŒåå››', qSuffix: 'æ—¥', a: 'ã«ã˜ã‚…ã†ã‚ˆã£ã‹' },
                { num: 11, numKanji: 'åä¸€', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã„ã¡ã«ã¡'}, {num: 12, numKanji: 'åäºŒ', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã«ã«ã¡'},
                { num: 13, numKanji: 'åä¸‰', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã•ã‚“ã«ã¡'}, {num: 15, numKanji: 'åäº”', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã”ã«ã¡'},
                { num: 16, numKanji: 'åå…­', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã‚ãã«ã¡'}, {num: 17, numKanji: 'åä¸ƒ', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã—ã¡ã«ã¡'},
                { num: 18, numKanji: 'åå…«', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ã¯ã¡ã«ã¡'}, {num: 19, numKanji: 'åä¹', qSuffix: 'æ—¥', a: 'ã˜ã‚…ã†ãã«ã¡'},
                { num: 21, numKanji: 'äºŒåä¸€', qSuffix: 'æ—¥', a: 'ã«ã˜ã‚…ã†ã„ã¡ã«ã¡'}
            ]},
            // --- æ™‚ (ã˜) ---
            { type: 'number_counter_generated', counterKanji: 'æ™‚', range: [1, 12], generator: (num) => {
                const numStr = String(num);
                let reading = '';
                if (num === 4) reading = 'ã‚ˆã˜';
                else if (num === 7) reading = 'ã—ã¡ã˜'; // ãªãªã˜ is also common
                else if (num === 9) reading = 'ãã˜';
                else reading = (standardNumberReadings[numStr] || numStr) + 'ã˜';
                return { q: (numberToKanji[numStr] || numStr) + 'æ™‚', a: reading };
            }},
            // --- åˆ† (ãµã‚“/ã·ã‚“) ---
            { type: 'number_counter_generated', counterKanji: 'åˆ†', range: [1, 59], generator: (num) => {
                let reading = '';
                const numStr = String(num); // For Kanji display
                let displayNumKanji = "";
                if (num <= 20 && numberToKanji[numStr]) {
                    displayNumKanji = numberToKanji[numStr];
                } else if (num < 10) {
                    displayNumKanji = numberToKanji[numStr];
                } else { // For numbers > 20 or not in direct map, construct Kanji
                    const tens = Math.floor(num / 10);
                    const ones = num % 10;
                    if (tens > 0) displayNumKanji += (numberToKanji[String(tens)] || String(tens)) + "å";
                    if (ones > 0) displayNumKanji += numberToKanji[String(ones)] || String(ones);
                }


                const lastDigit = num % 10;
                let prefixReading = "";
                if (num >= 10) {
                    const tensDigit = Math.floor(num / 10);
                    if (tensDigit === 1) prefixReading = "ã˜ã‚…ã†";
                    else prefixReading = standardNumberReadings[String(tensDigit)] + "ã˜ã‚…ã†";
                }


                if (num === 1 || (num > 10 && lastDigit === 1)) reading = (num === 1 ? "" : prefixReading) + 'ã„ã£ã·ã‚“';
                else if (num === 3 || (num > 10 && lastDigit === 3)) reading = (num === 3 ? "" : prefixReading) + 'ã•ã‚“ã·ã‚“';
                else if (num === 4 || (num > 10 && lastDigit === 4)) reading = (num === 4 ? "" : prefixReading) + 'ã‚ˆã‚“ã·ã‚“';
                else if (num === 6 || (num > 10 && lastDigit === 6)) reading = (num === 6 ? "" : prefixReading) + 'ã‚ã£ã·ã‚“';
                else if (num === 8 || (num > 10 && lastDigit === 8)) reading = (num === 8 ? "" : prefixReading) + 'ã¯ã£ã·ã‚“';
                else if (num % 10 === 0) reading = prefixReading + 'ã·ã‚“'; // 10åˆ† (ã˜ã‚…ã£ã·ã‚“), 20åˆ† (ã«ã˜ã‚…ã£ã·ã‚“)
                else { // 2, 5, 7, 9 ending minutes
                    if (num < 10) reading = standardNumberReadings[String(lastDigit)] + 'ãµã‚“';
                    else reading = prefixReading + standardNumberReadings[String(lastDigit)] + 'ãµã‚“';
                }
                 // Specific overrides for common cases like 10, 20 etc.
                if (num === 10) reading = 'ã˜ã‚…ã£ã·ã‚“'; // Common alternative: ã˜ã£ã·ã‚“
                if (num === 20) reading = 'ã«ã˜ã‚…ã£ã·ã‚“';
                if (num === 30) reading = 'ã•ã‚“ã˜ã‚…ã£ã·ã‚“';
                if (num === 40) reading = 'ã‚ˆã‚“ã˜ã‚…ã£ã·ã‚“';
                if (num === 50) reading = 'ã”ã˜ã‚…ã£ã·ã‚“';


                return { q: displayNumKanji + 'åˆ†', a: reading };
            }},
            // --- å› (ã‹ã„) ---
            { type: 'number_counter_generated', counterKanji: 'å›', range: [1, 20], generator: (num) => {
                let reading = '';
                const numStr = String(num);
                const baseNumReading = standardNumberReadings[numStr] || numStr; // For single digits
                let displayNumKanji = numberToKanji[numStr] || numStr;
                let prefixReading = "";

                if (num > 10) {
                     const tens = Math.floor(num / 10);
                     const ones = num % 10;
                     prefixReading = (tens === 1 ? "ã˜ã‚…ã†" : standardNumberReadings[String(tens)] + "ã˜ã‚…ã†");
                     if (ones === 0) displayNumKanji = (numberToKanji[String(tens)] || String(tens)) + "å";
                     else displayNumKanji = (numberToKanji[String(tens)] || String(tens)) + "å" + (numberToKanji[String(ones)] || String(ones));
                }


                if (num === 1 || (num > 10 && num % 10 === 1)) reading = (num === 1 ? "" : prefixReading) + 'ã„ã£ã‹ã„';
                else if (num === 6 || (num > 10 && num % 10 === 6)) reading = (num === 6 ? "" : prefixReading) + 'ã‚ã£ã‹ã„';
                else if (num === 8 || (num > 10 && num % 10 === 8)) reading = (num === 8 ? "" : prefixReading) + 'ã¯ã£ã‹ã„';
                else if (num % 10 === 0 ) reading = (num === 10 ? "ã˜ã£" : prefixReading.slice(0,-3) + "ã˜ã£") + 'ã‹ã„'; // ã˜ã£ã‹ã„, ã«ã˜ã£ã‹ã„
                else reading = (num > 10 ? prefixReading + (standardNumberReadings[String(num%10)] || String(num%10)) : baseNumReading) + 'ã‹ã„';

                if (num === 10) reading = 'ã˜ã£ã‹ã„'; // Common alt: ã˜ã‚…ã£ã‹ã„

                return { q: displayNumKanji + 'å›', a: reading };
            }},
            // --- å†Š (ã•ã¤) ---
            { type: 'number_counter_generated', counterKanji: 'å†Š', range: [1, 20], generator: (num) => {
                let reading = '';
                const numStr = String(num);
                const baseNumReading = standardNumberReadings[numStr] || numStr;
                let displayNumKanji = numberToKanji[numStr] || numStr;
                let prefixReading = "";

                 if (num > 10) {
                     const tens = Math.floor(num / 10);
                     const ones = num % 10;
                     prefixReading = (tens === 1 ? "ã˜ã‚…ã†" : standardNumberReadings[String(tens)] + "ã˜ã‚…ã†");
                     if (ones === 0) displayNumKanji = (numberToKanji[String(tens)] || String(tens)) + "å";
                     else displayNumKanji = (numberToKanji[String(tens)] || String(tens)) + "å" + (numberToKanji[String(ones)] || String(ones));
                }

                if (num === 1 || (num > 10 && num % 10 === 1)) reading = (num === 1 ? "" : prefixReading) + 'ã„ã£ã•ã¤';
                else if (num === 8 || (num > 10 && num % 10 === 8)) reading = (num === 8 ? "" : prefixReading) + 'ã¯ã£ã•ã¤';
                else if (num % 10 === 0) reading = (num === 10 ? "ã˜ã£" : prefixReading.slice(0,-3) + "ã˜ã£") + 'ã•ã¤'; // ã˜ã£ã•ã¤, ã«ã˜ã£ã•ã¤
                else reading = (num > 10 ? prefixReading + (standardNumberReadings[String(num%10)] || String(num%10)) : baseNumReading) + 'ã•ã¤';

                if (num === 10) reading = 'ã˜ã£ã•ã¤'; // Common alt: ã˜ã‚…ã£ã•ã¤

                return { q: displayNumKanji + 'å†Š', a: reading };
            }},
            // --- ç€ (ã¡ã‚ƒã) ---
            { type: 'number_counter_generated', counterKanji: 'ç€', range: [1, 10], generator: (num) => {
                let reading = '';
                const numStr = String(num);
                const baseNumReading = standardNumberReadings[numStr] || numStr;
                if (num === 1) reading = 'ã„ã£ã¡ã‚ƒã';
                else if (num === 8) reading = 'ã¯ã£ã¡ã‚ƒã';
                else if (num === 10) reading = 'ã˜ã£ã¡ã‚ƒã'; // æˆ– ã˜ã‚…ã£ã¡ã‚ƒã
                else reading = baseNumReading + 'ã¡ã‚ƒã';
                return { q: (numberToKanji[numStr] || numStr) + 'ç€', a: reading };
            }},
            // --- æš (ã¾ã„) ---
            { type: 'number_counter_generated', counterKanji: 'æš', range: [1, 20], generator: (num) => {
                const numStr = String(num);
                let kanjiPart = numberToKanji[numStr] || numStr;
                let readingPart = "";

                 if (num <= 9) {
                    readingPart = standardNumberReadings[numStr] || numStr;
                 } else if (num === 10) {
                    readingPart = "ã˜ã‚…ã†";
                 } else if (num > 10 && num <=20) { // 11-20
                    const tens = Math.floor(num/10);
                    const ones = num % 10;
                    readingPart = (tens === 1 ? "ã˜ã‚…ã†" : standardNumberReadings[String(tens)]+"ã˜ã‚…ã†") + (standardNumberReadings[String(ones)] || "");
                     if (num === 20) readingPart = "ã«ã˜ã‚…ã†";
                 }
                return { q: kanjiPart + 'æš', a: readingPart + 'ã¾ã„' };
            }},
        ];

        // --- DOM Elements ---
        const questionArea = document.getElementById('questionArea');
        const answerInput = document.getElementById('answerInput');
        const checkButton = document.getElementById('checkButton');
        const nextButton = document.getElementById('nextButton');
        const feedbackArea = document.getElementById('feedbackArea');
        const scoreDisplay = document.getElementById('score');

        // --- Quiz State ---
        let currentQuestionData = null;
        let score = 0;

        // --- Functions ---
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateQuestion() {
            answerInput.value = '';
            feedbackArea.textContent = '';
            feedbackArea.className = '';
            answerInput.disabled = false;
            checkButton.disabled = false;

            const categoryIndex = getRandomInt(0, quizData.length - 1);
            const category = quizData[categoryIndex];

            if (category.type === 'standalone_number' || category.type === 'number_counter') {
                const itemIndex = getRandomInt(0, category.values.length - 1);
                const item = category.values[itemIndex];
                currentQuestionData = { q: item.q, a: item.a };
                 if (category.type === 'number_counter') {
                    currentQuestionData.q = item.numKanji + item.qSuffix;
                }
            } else if (category.type === 'number_counter_generated') {
                const num = getRandomInt(category.range[0], category.range[1]);
                currentQuestionData = category.generator(num);
            } else if (category.type === 'complex_number') {
                const num = getRandomInt(category.range[0], category.range[1]);
                currentQuestionData = category.generator(num); // q, a, kanji_representation
            }
            questionArea.textContent = currentQuestionData.q;
        }

        function checkAnswer() {
            const userAnswer = answerInput.value.trim().replace(/ã‚”/g, 'ã†ã‚›'); // Normalize ã‚” to ã†ã‚› if needed for some IME inputs
            if (!userAnswer) {
                feedbackArea.textContent = 'è¯·è¾“å…¥ç­”æ¡ˆï¼';
                feedbackArea.className = 'incorrect';
                return;
            }

            if (userAnswer === currentQuestionData.a) {
                feedbackArea.textContent = 'æ­£ç¡®ï¼ ğŸ‰';
                if (currentQuestionData.kanji_representation) {
                    feedbackArea.textContent += ` (${currentQuestionData.kanji_representation})`;
                }
                feedbackArea.className = 'correct';
                score++;
                scoreDisplay.textContent = score;
            } else {
                let correctAnswerText = `é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯: ${currentQuestionData.a}`;
                if (currentQuestionData.kanji_representation) {
                    correctAnswerText += ` ( ${currentQuestionData.kanji_representation} )`;
                } else if (currentQuestionData.type === 'standalone_number' || currentQuestionData.type === 'number_counter' || currentQuestionData.type === 'number_counter_generated') {
                    // For other types, the question itself is often the Kanji form
                    // correctAnswerText += ` ( ${currentQuestionData.q} )`; // This might be redundant if q is already Kanji
                }
                feedbackArea.textContent = correctAnswerText;
                feedbackArea.className = 'incorrect';
            }
            answerInput.disabled = true;
            checkButton.disabled = true;
        }

        // --- Event Listeners ---
        checkButton.addEventListener('click', checkAnswer);
        nextButton.addEventListener('click', generateQuestion);
        answerInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                if (!checkButton.disabled) {
                     checkAnswer();
                } else {
                    generateQuestion();
                }
            }
        });

        // --- Initial Load ---
        generateQuestion();
    </script>
</body>
</html>
