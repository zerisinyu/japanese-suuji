<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日语数字和量词练习</title>
    <style>
        body {
            font-family: 'Arial', 'Meiryo', 'Hiragino Kaku Gothic ProN', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f7ff;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .quiz-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        #questionArea {
            font-size: 2.5em; /* 更大的字号以便看清题目 */
            color: #0056b3;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #e9f5ff;
            border-radius: 8px;
            min-height: 60px; /* 确保有足够高度 */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #answerInput {
            width: calc(100% - 22px); /* 减去padding和border */
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1.2em;
            box-sizing: border-box;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 5px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
        }

        #checkButton {
            background-color: #28a745;
        }
        #checkButton:hover {
            background-color: #1e7e34;
        }

        #feedbackArea {
            margin-top: 20px;
            font-size: 1.1em;
            min-height: 30px; /* 确保有足够高度 */
            font-weight: bold;
        }

        .correct {
            color: #28a745;
        }

        .incorrect {
            color: #dc3545;
        }

        #scoreArea {
            margin-top: 25px;
            font-size: 1.2em;
            color: #555;
        }

        /* 响应式设计 */
        @media (max-width: 600px) {
            .quiz-container {
                padding: 20px;
            }
            h1 {
                font-size: 1.5em;
            }
            #questionArea {
                font-size: 2em;
            }
            #answerInput, button {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>日语数字和量词练习</h1>
        <div id="questionArea"></div>
        <input type="text" id="answerInput" placeholder="请输入读音 (平假名)">
        <button id="checkButton">检查答案</button>
        <button id="nextButton">下一个</button>
        <div id="feedbackArea"></div>
        <div id="scoreArea">分数: <span id="score">0</span></div>
    </div>

    <script>
        // --- 数据定义区 ---
        const singleDigitReadings = { // 更改变量名以示区分
            '1': 'いち', '2': 'に', '3': 'さん', '4': 'よん', '5': 'ご', '6': 'ろく', '7': 'なな', '8': 'はち', '9': 'きゅう', '0': ''
        };
        const singleDigitKanji = { // 更改变量名
            '0': '零', '1': '一', '2': '二', '3': '三', '4': '四', '5': '五', '6': '六', '7': '七', '8': '八', '9': '九'
        };

        /**
         * Converts a number (0-9999) to its Japanese Kanji and Hiragana reading.
         * This function is for components of larger numbers or standalone numbers up to 9999.
         * It correctly omits "一" before 十, 百, 千 when appropriate (e.g., 19 -> 十九, 100 -> 百).
         * @param {number} num_to_convert - The number to convert (0-9999).
         * @returns {{kanji: string, reading: string}}
         */
        function numToJapaneseSimple(num_to_convert) {
            if (num_to_convert === 0) return { kanji: "", reading: "" }; // For composition, 0 is empty
            if (num_to_convert > 9999 || num_to_convert < 0) {
                 console.warn("numToJapaneseSimple called with number out of 0-9999 range:", num_to_convert);
                 return {kanji: String(num_to_convert), reading: String(num_to_convert)}; // Fallback
            }

            let n = num_to_convert;
            let k = "";
            let r = "";

            // 千の位 (Thousands place)
            if (n >= 1000) {
                const thousands = Math.floor(n / 1000);
                if (thousands === 1) {
                    k += "千";
                    r += "せん";
                } else {
                    k += (singleDigitKanji[String(thousands)] || String(thousands)) + "千";
                    if (thousands === 3) r += "さんぜん";
                    else if (thousands === 8) r += "はっせん";
                    else r += (singleDigitReadings[String(thousands)] || String(thousands)) + "せん";
                }
                n %= 1000;
            }

            // 百の位 (Hundreds place)
            if (n >= 100) {
                const hundreds = Math.floor(n / 100);
                if (hundreds === 1) {
                    k += "百";
                    r += "ひゃく";
                } else {
                    k += (singleDigitKanji[String(hundreds)] || String(hundreds)) + "百";
                    if (hundreds === 3) r += "さんびゃく";
                    else if (hundreds === 6) r += "ろっぴゃく";
                    else if (hundreds === 8) r += "はっぴゃく";
                    else r += (singleDigitReadings[String(hundreds)] || String(hundreds)) + "ひゃく";
                }
                n %= 100;
            }

            // 十の位 (Tens place)
            if (n >= 10) {
                const tens = Math.floor(n / 10);
                if (tens === 1) {
                    k += "十";
                    r += "じゅう";
                } else {
                    k += (singleDigitKanji[String(tens)] || String(tens)) + "十";
                    r += (singleDigitReadings[String(tens)] || String(tens)) + "じゅう";
                }
                n %= 10;
            }

            // 一の位 (Ones place)
            if (n > 0) {
                k += singleDigitKanji[String(n)] || String(n);
                r += singleDigitReadings[String(n)] || String(n);
            }
            return { kanji: k, reading: r };
        }

        /**
         * Converts a larger number to its full Japanese Kanji and Hiragana reading.
         * Uses numToJapaneseSimple for segments.
         * @param {number} num_orig - The original number to convert.
         * @returns {{kanji: string, reading: string}}
         */
        function numToJapanese(num_orig) {
            if (num_orig === 0) return { kanji: "零", reading: "れい" }; // Or ゼロ
            // Limit for this quiz, can be expanded
            if (num_orig > 99999999 || num_orig < 0) {
                 console.warn("numToJapanese called with number out of reasonable range:", num_orig);
                 return {kanji: String(num_orig) + " (转换超出范围)", reading: String(num_orig) + " (转换超出范围)"};
            }

            let num = num_orig;
            let k = "";
            let r = "";

            // 億 (oku - 100,000,000s) - Optional, can be added if needed
            // if (num >= 100000000) {
            //     const okuVal = Math.floor(num / 100000000);
            //     const okuParts = numToJapaneseSimple(okuVal); // Handles numbers like "三" for 三億
            //     k += okuParts.kanji + "億";
            //     r += okuParts.reading + "おく";
            //     num %= 100000000;
            //     if (num === 0) return { kanji: k, reading: r };
            // }

            // 万 (man - 10,000s)
            if (num >= 10000) {
                const manVal = Math.floor(num / 10000);
                const manParts = numToJapaneseSimple(manVal); // e.g., for 123万, manVal is 123
                k += manParts.kanji + "万";
                r += manParts.reading + "まん";
                num %= 10000;
                if (num === 0) return { kanji: k, reading: r };
            }

            // Remainder part (0-9999)
            if (num > 0 || k === "") { // If k is empty, means original number was < 10000
                const restParts = numToJapaneseSimple(num);
                k += restParts.kanji;
                r += restParts.reading;
            }
            
            // If k and r are still empty, it means num_orig was 0 but not caught by the first check (shouldn't happen)
            // or numToJapaneseSimple returned empty for a positive num (also shouldn't happen).
            if (k === "" && r === "" && num_orig > 0) {
                 // This is a fallback, numToJapaneseSimple should handle 1-9999
                 console.error("Failed to convert positive number:", num_orig);
                 return {kanji: String(num_orig), reading: String(num_orig)};
            }

            return { kanji: k, reading: r };
        }


        const quizData = [
            // --- 百位 (Standalone Hundreds) ---
            { type: 'standalone_number', unit: '百', values: [
                { num: 100, q: '百', a: 'ひゃく' }, { num: 200, q: '二百', a: 'にひゃく' },
                { num: 300, q: '三百', a: 'さんびゃく' }, { num: 400, q: '四百', a: 'よんひゃく' },
                { num: 500, q: '五百', a: 'ごひゃく' }, { num: 600, q: '六百', a: 'ろっぴゃく' },
                { num: 700, q: '七百', a: 'ななひゃく' }, { num: 800, q: '八百', a: 'はっぴゃく' },
                { num: 900, q: '九百', a: 'きゅうひゃく' }
            ]},
            // --- 千位 (Standalone Thousands) ---
            { type: 'standalone_number', unit: '千', values: [
                { num: 1000, q: '千', a: 'せん' }, { num: 2000, q: '二千', a: 'にせん' },
                { num: 3000, q: '三千', a: 'さんぜん' }, { num: 4000, q: '四千', a: 'よんせん' }, // Note: よんせん is common
                { num: 5000, q: '五千', a: 'ごせん' }, { num: 6000, q: '六千', a: 'ろくせん' },
                { num: 7000, q: '七千', a: 'ななせん' }, { num: 8000, q: '八千', a: 'はっせん' },
                { num: 9000, q: '九千', a: 'きゅうせん' }
            ]},
            // --- 复杂数字 (Complex Numbers) ---
            {
                type: 'complex_number',
                displayName: '复杂数字',
                range: [101, 99999], // Generate numbers in this range
                generator: function(num_to_generate_for_q) { // Parameter name changed for clarity
                    // Filter out simple hundreds/thousands
                    let num;
                    do {
                        num = getRandomInt(this.range[0], this.range[1]);
                    } while (
                        (num < 1000 && num % 100 === 0) || // e.g., 100, 200, ..., 900
                        (num < 10000 && num % 1000 === 0)  // e.g., 1000, 2000, ..., 9000
                    );
                    const japaneseParts = numToJapanese(num);
                    return {
                        q: String(num), // Question is the Arabic numeral
                        a: japaneseParts.reading, // Answer is the Hiragana reading
                        kanji_representation: japaneseParts.kanji // For feedback
                    };
                }
            },
            // --- 月 (がつ - months) ---
            { type: 'number_counter_list', counterKanji: '月', items: [ // Changed type for clarity
                { num: 1, numKanji: '一', qSuffix: '月', a: 'いちがつ' }, { num: 2, numKanji: '二', qSuffix: '月', a: 'にがつ' },
                { num: 3, numKanji: '三', qSuffix: '月', a: 'さんがつ' }, { num: 4, numKanji: '四', qSuffix: '月', a: 'しがつ' },
                { num: 5, numKanji: '五', qSuffix: '月', a: 'ごがつ' }, { num: 6, numKanji: '六', qSuffix: '月', a: 'ろくがつ' },
                { num: 7, numKanji: '七', qSuffix: '月', a: 'しちがつ' }, { num: 8, numKanji: '八', qSuffix: '月', a: 'はちがつ' },
                { num: 9, numKanji: '九', qSuffix: '月', a: 'くがつ' }, { num: 10, numKanji: '十', qSuffix: '月', a: 'じゅうがつ' },
                { num: 11, numKanji: '十一', qSuffix: '月', a: 'じゅういちがつ' }, { num: 12, numKanji: '十二', qSuffix: '月', a: 'じゅうにがつ' }
            ]},
            // --- 日 (にち/か - days of the month) ---
            { type: 'number_counter_list', counterKanji: '日', items: [
                { num: 1, numKanji: '一', qSuffix: '日', a: 'ついたち' }, { num: 2, numKanji: '二', qSuffix: '日', a: 'ふつか' },
                { num: 3, numKanji: '三', qSuffix: '日', a: 'みっか' }, { num: 4, numKanji: '四', qSuffix: '日', a: 'よっか' },
                { num: 5, numKanji: '五', qSuffix: '日', a: 'いつか' }, { num: 6, numKanji: '六', qSuffix: '日', a: 'むいか' },
                { num: 7, numKanji: '七', qSuffix: '日', a: 'なのか' }, { num: 8, numKanji: '八', qSuffix: '日', a: 'ようか' },
                { num: 9, numKanji: '九', qSuffix: '日', a: 'ここのか' }, { num: 10, numKanji: '十', qSuffix: '日', a: 'とおか' },
                { num: 11, numKanji: '十一', qSuffix: '日', a: 'じゅういちにち'}, {num: 12, numKanji: '十二', qSuffix: '日', a: 'じゅうににち'},
                { num: 13, numKanji: '十三', qSuffix: '日', a: 'じゅうさんにち'}, { num: 14, numKanji: '十四', qSuffix: '日', a: 'じゅうよっか' },
                {num: 15, numKanji: '十五', qSuffix: '日', a: 'じゅうごにち'}, { num: 16, numKanji: '十六', qSuffix: '日', a: 'じゅうろくにち'},
                {num: 17, numKanji: '十七', qSuffix: '日', a: 'じゅうしちにち'}, {num: 18, numKanji: '十八', qSuffix: '日', a: 'じゅうはちにち'},
                {num: 19, numKanji: '十九', qSuffix: '日', a: 'じゅうくにち'}, { num: 20, numKanji: '二十', qSuffix: '日', a: 'はつか' },
                { num: 21, numKanji: '二十一', qSuffix: '日', a: 'にじゅういちにち'}, { num: 24, numKanji: '二十四', qSuffix: '日', a: 'にじゅうよっか' }
            ]},
            // --- 時 (じ - o'clock) ---
            { type: 'number_counter_generated', counterKanji: '時', range: [1, 12], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 4) answerReading = 'よじ';
                else if (num === 7) answerReading = 'しちじ'; // ななじ is also common
                else if (num === 9) answerReading = 'くじ';
                else answerReading = readingNumPart + 'じ';
                return { q: kanjiNumPart + '時', a: answerReading };
            }},
            // --- 分 (ふん/ぷん - minutes) ---
            { type: 'number_counter_generated', counterKanji: '分', range: [1, 59], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                const lastDigit = num % 10;

                if (num === 1 || (num > 10 && lastDigit === 1 && num !== 11 && num !== 21 && num !== 31 && num !== 41 && num !== 51) || num === 11 || num === 21 || num === 31 || num === 41 || num === 51) { // e.g. 一分,十分後の一分 (じゅういっぷん is not standard for 11分)
                     if (num === 1) answerReading = 'いっぷん';
                     else answerReading = readingNumPart.slice(0, -2) + 'いっぷん'; // e.g. じゅう + いっぷん for 11分
                } else if (num === 3 || (num > 10 && lastDigit === 3)) answerReading = readingNumPart.slice(0, -2) + 'さんぷん'; // じゅうさんぷん
                else if (num === 4 || (num > 10 && lastDigit === 4)) answerReading = readingNumPart.slice(0, -2) + 'よんぷん'; // じゅうよんぷん
                else if (num === 6 || (num > 10 && lastDigit === 6)) answerReading = readingNumPart.slice(0, -3) + 'ろっぷん'; // じゅうろっぷん (ろく ends in く)
                else if (num === 8 || (num > 10 && lastDigit === 8)) answerReading = readingNumPart.slice(0, -2) + 'はっぷん'; // じゅうはっぷん (はち ends in ち)
                else if (num % 10 === 0) { // 10, 20, 30, 40, 50
                    if (num === 10) answerReading = 'じゅっぷん'; // or じっぷん
                    else answerReading = readingNumPart.slice(0, -3) + 'っぷん'; // e.g. にじゅっぷん (remove じゅう, add っぷん)
                }
                else answerReading = readingNumPart + 'ふん'; // Default for 2, 5, 7, 9 endings

                // Refinements for specific cases if general logic is not perfect
                if (num === 1) answerReading = 'いっぷん';
                else if (num === 10) answerReading = 'じゅっぷん'; // Common: じっぷん
                else if (num === 20) answerReading = 'にじっぷん'; // Common: にじゅっぷん
                else if (num === 30) answerReading = 'さんじっぷん'; // Common: さんじゅっぷん
                else if (num === 40) answerReading = 'よんじっぷん'; // Common: よんじゅっぷん
                else if (num === 50) answerReading = 'ごじっぷん'; // Common: ごじゅっぷん
                // For combined numbers like 21分 (にじゅういっぷん)
                else if (num > 10 && lastDigit === 1) answerReading = readingNumPart.slice(0, readingNumPart.length - (singleDigitReadings[String(lastDigit)].length)) + 'いっぷん';
                else if (num > 10 && lastDigit === 3) answerReading = readingNumPart.slice(0, readingNumPart.length - (singleDigitReadings[String(lastDigit)].length)) + 'さんぷん';
                else if (num > 10 && lastDigit === 4) answerReading = readingNumPart.slice(0, readingNumPart.length - (singleDigitReadings[String(lastDigit)].length)) + 'よんぷん';
                // etc. for other endings if needed, though the general rule might cover them.

                return { q: kanjiNumPart + '分', a: answerReading };
            }},
            // --- 回 (かい - times) ---
            { type: 'number_counter_generated', counterKanji: '回', range: [1, 20], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1 || (num > 10 && num % 10 === 1)) answerReading = readingNumPart.slice(0, -2) + 'いっかい'; // いち -> いっ
                else if (num === 6 || (num > 10 && num % 10 === 6)) answerReading = readingNumPart.slice(0, -2) + 'ろっかい'; // ろく -> ろっ
                else if (num === 8 || (num > 10 && num % 10 === 8)) answerReading = readingNumPart.slice(0, -2) + 'はっかい'; // はち -> はっ
                else if (num === 10) answerReading = 'じっかい'; // or じゅっかい
                else if (num > 10 && num % 10 === 0) answerReading = readingNumPart.slice(0,-3) + 'っかい'; // e.g. にじっかい (from にじゅう)
                else answerReading = readingNumPart + 'かい';
                if (num === 1) answerReading = 'いっかい'; // Override for standalone 1
                 if (num === 10) answerReading = 'じっかい';


                return { q: kanjiNumPart + '回', a: answerReading };
            }},
            // --- 冊 (さつ - bound volumes) ---
            { type: 'number_counter_generated', counterKanji: '冊', range: [1, 20], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1 || (num > 10 && num % 10 === 1)) answerReading = readingNumPart.slice(0, -2) + 'いっさつ';
                else if (num === 8 || (num > 10 && num % 10 === 8)) answerReading = readingNumPart.slice(0, -2) + 'はっさつ';
                else if (num === 10) answerReading = 'じっさつ'; // or じゅっさつ
                else if (num > 10 && num % 10 === 0) answerReading = readingNumPart.slice(0,-3) + 'っさつ'; // e.g. にじっさつ
                else answerReading = readingNumPart + 'さつ';
                if (num === 1) answerReading = 'いっさつ';
                if (num === 10) answerReading = 'じっさつ';

                return { q: kanjiNumPart + '冊', a: answerReading };
            }},
            // --- 着 (ちゃく - clothing) ---
            { type: 'number_counter_generated', counterKanji: '着', range: [1, 10], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1) answerReading = 'いっちゃく';
                else if (num === 8) answerReading = 'はっちゃく';
                else if (num === 10) answerReading = 'じっちゃく'; // or じゅっちゃく
                else answerReading = readingNumPart + 'ちゃく';
                return { q: kanjiNumPart + '着', a: answerReading };
            }},
            // --- 枚 (まい - flat objects) ---
            { type: 'number_counter_generated', counterKanji: '枚', range: [1, 20], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                return { q: kanjiNumPart + '枚', a: readingNumPart + 'まい' }; // まい is regular
            }},
            // --- 人 (にん/り - people) ---
            { type: 'number_counter_generated', counterKanji: '人', range: [1, 10], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1) answerReading = 'ひとり';
                else if (num === 2) answerReading = 'ふたり';
                else if (num === 4) answerReading = 'よにん'; // Special reading for 4
                else answerReading = readingNumPart + 'にん';
                return { q: kanjiNumPart + '人', a: answerReading };
            }},
        ];

        // --- DOM Elements ---
        const questionArea = document.getElementById('questionArea');
        const answerInput = document.getElementById('answerInput');
        const checkButton = document.getElementById('checkButton');
        const nextButton = document.getElementById('nextButton');
        const feedbackArea = document.getElementById('feedbackArea');
        const scoreDisplay = document.getElementById('score');

        // --- Quiz State ---
        let currentQuestionData = null;
        let score = 0;

        // --- Functions ---
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateQuestion() {
            answerInput.value = '';
            feedbackArea.textContent = '';
            feedbackArea.className = '';
            answerInput.disabled = false;
            checkButton.disabled = false;

            const categoryIndex = getRandomInt(0, quizData.length - 1);
            const category = quizData[categoryIndex];

            if (category.type === 'standalone_number' || category.type === 'number_counter_list') {
                // For 'standalone_number', 'values' is the array; for 'number_counter_list', 'items' is the array.
                const itemsArray = category.values || category.items;
                const itemIndex = getRandomInt(0, itemsArray.length - 1);
                const item = itemsArray[itemIndex];
                currentQuestionData = { q: item.q, a: item.a, type: category.type }; // Store type for feedback if needed
                 if (category.type === 'number_counter_list') {
                    currentQuestionData.q = item.numKanji + item.qSuffix;
                }
            } else if (category.type === 'number_counter_generated' || category.type === 'complex_number') {
                // For complex_number, the generator doesn't take a num argument directly here, it uses its range.
                // For number_counter_generated, it needs a random number from its range.
                const numForGenerator = (category.type === 'complex_number') ? null : getRandomInt(category.range[0], category.range[1]);
                currentQuestionData = category.generator(numForGenerator);
                currentQuestionData.type = category.type; // Store type
            }
            questionArea.textContent = currentQuestionData.q;
        }

        function checkAnswer() {
            const userAnswer = answerInput.value.trim().replace(/ゔ/g, 'う゛');
            if (!userAnswer) {
                feedbackArea.textContent = '请输入答案！';
                feedbackArea.className = 'incorrect';
                return;
            }

            if (userAnswer === currentQuestionData.a) {
                feedbackArea.textContent = '正确！ 🎉';
                if (currentQuestionData.type === 'complex_number' && currentQuestionData.kanji_representation) {
                    feedbackArea.textContent += ` (${currentQuestionData.kanji_representation})`;
                }
                feedbackArea.className = 'correct';
                score++;
                scoreDisplay.textContent = score;
            } else {
                let correctAnswerText = `错误。正确答案是: ${currentQuestionData.a}`;
                if (currentQuestionData.type === 'complex_number' && currentQuestionData.kanji_representation) {
                    correctAnswerText += ` ( ${currentQuestionData.kanji_representation} )`;
                }
                feedbackArea.textContent = correctAnswerText;
                feedbackArea.className = 'incorrect';
            }
            answerInput.disabled = true;
            checkButton.disabled = true;
        }

        // --- Event Listeners ---
        checkButton.addEventListener('click', checkAnswer);
        nextButton.addEventListener('click', generateQuestion);
        answerInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                if (!checkButton.disabled) {
                     checkAnswer();
                } else {
                    generateQuestion();
                }
            }
        });

        // --- Initial Load ---
        generateQuestion();
    </script>
</body>
</html>
