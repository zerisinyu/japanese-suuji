<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Numbers & Counters Quiz</title>
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic ProN', '„Éí„É©„ÇÆ„ÉéËßí„Ç¥ ProN W3', 'Meiryo', '„É°„Ç§„É™„Ç™', 'Osaka', 'MS PGothic', 'Ôº≠Ôº≥ Ôº∞„Ç¥„Ç∑„ÉÉ„ÇØ', 'Arial', sans-serif;
            display: flex;
            flex-direction: column; /* Allow toggle to be above quiz */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f1ea; /* Softer, traditional paper-like background */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #333; /* Default text color */
        }

        .language-toggle-container {
            margin-bottom: 20px;
            text-align: center;
        }

        #languageToggle {
            background-color: #8b5e3c; /* Earthy brown */
            color: #f4f1ea;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #languageToggle:hover {
            background-color: #7a5230;
        }
        #languageToggle:active {
            transform: translateY(1px);
        }

        .quiz-container {
            background-color: #ffffff;
            padding: 35px 40px; /* Increased padding */
            border-radius: 12px; /* Softer radius */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); /* Softer shadow */
            width: 100%;
            max-width: 550px; /* Slightly wider */
            text-align: center;
        }

        h1 {
            color: #4a4a4a; /* Darker, softer gray */
            margin-bottom: 30px;
            font-size: 2em; /* Slightly larger */
            font-weight: 600;
        }

        #questionArea {
            font-size: 2.8em;
            color: #2c5282; /* Deep blue for questions */
            margin-bottom: 30px;
            padding: 20px;
            background-color: #e6f0f7; /* Lighter blueish background */
            border-radius: 10px;
            min-height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        #answerInput {
            width: calc(100% - 24px);
            padding: 15px; /* More padding */
            margin-bottom: 25px;
            border: 1px solid #d1d5db; /* Lighter border */
            border-radius: 8px;
            font-size: 1.2em;
            box-sizing: border-box;
            color: #333;
        }
        #answerInput::placeholder {
            color: #9ca3af;
        }


        .buttons-group {
            display: flex;
            justify-content: center;
            gap: 15px; /* Space between buttons */
        }

        button.quiz-button { /* Specific class for quiz buttons */
            color: white;
            border: none;
            padding: 14px 22px; /* Larger padding */
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button.quiz-button:hover {
            opacity: 0.9;
        }
        button.quiz-button:active {
            transform: translateY(1px);
        }


        #checkButton {
            background-color: #38a169; /* Green for check */
        }
        #checkButton:hover {
            background-color: #2f855a;
        }

        #nextButton {
            background-color: #3182ce; /* Blue for next */
        }
        #nextButton:hover {
            background-color: #2b6cb0;
        }


        #feedbackArea {
            margin-top: 25px;
            font-size: 1.15em;
            min-height: 35px;
            font-weight: 600;
        }

        .correct {
            color: #38a169; /* Consistent green */
        }

        .incorrect {
            color: #e53e3e; /* Consistent red */
        }

        #scoreArea {
            margin-top: 30px;
            font-size: 1.25em;
            color: #555;
            font-weight: 500;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 600px) {
            .quiz-container {
                padding: 25px 20px;
            }
            h1 {
                font-size: 1.6em;
            }
            #questionArea {
                font-size: 2.2em;
                padding: 15px;
                min-height: 60px;
            }
            #answerInput, button.quiz-button {
                font-size: 1em;
                padding: 12px 18px;
            }
            #languageToggle {
                font-size: 0.8em;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="language-toggle-container">
        <button id="languageToggle">ÂàáÊç¢ËØ≠Ë®Ä (Switch Language)</button>
    </div>

    <div class="quiz-container">
        <h1 id="uiTitle">Êó•ËØ≠Êï∞Â≠óÂíåÈáèËØçÁªÉ‰π†</h1>
        <div id="questionArea"></div>
        <input type="text" id="answerInput" placeholder="ËØ∑ËæìÂÖ•ËØªÈü≥ (Âπ≥ÂÅáÂêç)">
        <div class="buttons-group">
            <button id="checkButton" class="quiz-button">Ê£ÄÊü•Á≠îÊ°à</button>
            <button id="nextButton" class="quiz-button">‰∏ã‰∏Ä‰∏™</button>
        </div>
        <div id="feedbackArea"></div>
        <div id="scoreArea"><span id="uiScoreLabel">ÂàÜÊï∞</span>: <span id="score">0</span></div>
    </div>

    <script>
        // --- UI Text Strings for Localization ---
        const uiStrings = {
            zh: {
                htmlLang: 'zh-CN',
                title: 'Êó•ËØ≠Êï∞Â≠óÂíåÈáèËØçÁªÉ‰π†',
                checkAnswer: 'Ê£ÄÊü•Á≠îÊ°à',
                nextQuestion: '‰∏ã‰∏Ä‰∏™',
                scoreLabel: 'ÂàÜÊï∞',
                placeholder: 'ËØ∑ËæìÂÖ•ËØªÈü≥ (Âπ≥ÂÅáÂêç)',
                correctFeedback: 'Ê≠£Á°ÆÔºÅ ÔøΩ',
                incorrectFeedbackPrefix: 'ÈîôËØØ„ÄÇÊ≠£Á°ÆÁ≠îÊ°àÊòØ: ',
                inputPrompt: 'ËØ∑ËæìÂÖ•Á≠îÊ°àÔºÅ',
                toggleButton: 'ÂàáÊç¢Ëá≥ English',
                pageTitle: 'Êó•ËØ≠Êï∞Â≠óÂíåÈáèËØçÁªÉ‰π†'
            },
            en: {
                htmlLang: 'en',
                title: 'Japanese Numbers & Counters Quiz',
                checkAnswer: 'Check Answer',
                nextQuestion: 'Next',
                scoreLabel: 'Score',
                placeholder: 'Enter reading (Hiragana)',
                correctFeedback: 'Correct! üéâ',
                incorrectFeedbackPrefix: 'Incorrect. The correct answer is: ',
                inputPrompt: 'Please enter an answer!',
                toggleButton: 'ÂàáÊç¢Ëá≥ ‰∏≠Êñá',
                pageTitle: 'Japanese Quiz'
            }
        };
        let currentLanguage = 'zh'; // Default language

        // --- DOM Elements for UI Text ---
        const htmlElement = document.documentElement;
        const pageTitleElement = document.querySelector('title');
        const uiTitleElement = document.getElementById('uiTitle');
        const answerInputElement = document.getElementById('answerInput');
        const checkButtonElement = document.getElementById('checkButton');
        const nextButtonElement = document.getElementById('nextButton');
        const uiScoreLabelElement = document.getElementById('uiScoreLabel');
        const languageToggleButton = document.getElementById('languageToggle');


        // --- Function to update UI text based on current language ---
        function updateUIText() {
            const strings = uiStrings[currentLanguage];
            htmlElement.lang = strings.htmlLang;
            pageTitleElement.textContent = strings.pageTitle;
            uiTitleElement.textContent = strings.title;
            answerInputElement.placeholder = strings.placeholder;
            checkButtonElement.textContent = strings.checkAnswer;
            nextButtonElement.textContent = strings.nextQuestion;
            uiScoreLabelElement.textContent = strings.scoreLabel;
            languageToggleButton.textContent = strings.toggleButton;
        }

        // --- Function to set initial language based on browser settings ---
        function setInitialLanguage() {
            const browserLang = (navigator.language || navigator.userLanguage || 'zh').toLowerCase();
            if (browserLang.startsWith('en')) {
                currentLanguage = 'en';
            } else {
                currentLanguage = 'zh'; // Default to Chinese for other cases or specific zh variants
            }
            updateUIText();
        }

        // --- Language Toggle Event Listener ---
        languageToggleButton.addEventListener('click', () => {
            currentLanguage = (currentLanguage === 'zh') ? 'en' : 'zh';
            updateUIText();
            // If a question is loaded and feedback is shown, re-render feedback in new language
            if (feedbackArea.textContent && currentQuestionData) {
                const userAnswer = answerInputElement.value.trim(); // Keep user's answer
                // Simulate a check to re-display feedback in the new language
                // This is a bit of a hack; a more robust solution would store feedback state separately
                const isCurrentlyCorrect = feedbackArea.classList.contains('correct');
                const tempAnswer = currentQuestionData.a; // Store correct answer

                if (isCurrentlyCorrect) {
                     feedbackArea.textContent = uiStrings[currentLanguage].correctFeedback;
                     if (currentQuestionData.type === 'complex_number' && currentQuestionData.kanji_representation) {
                        feedbackArea.textContent += ` (${currentQuestionData.kanji_representation})`;
                     }
                } else {
                    let correctAnswerText = `${uiStrings[currentLanguage].incorrectFeedbackPrefix}${tempAnswer}`;
                    if (currentQuestionData.type === 'complex_number' && currentQuestionData.kanji_representation) {
                        correctAnswerText += ` ( ${currentQuestionData.kanji_representation} )`;
                    }
                    feedbackArea.textContent = correctAnswerText;
                }
            }
        });


        // --- Êï∞ÊçÆÂÆö‰πâÂå∫ (Japanese content - no change needed for UI language) ---
        const singleDigitReadings = {
            '1': '„ÅÑ„Å°', '2': '„Å´', '3': '„Åï„Çì', '4': '„Çà„Çì', '5': '„Åî', '6': '„Çç„Åè', '7': '„Å™„Å™', '8': '„ÅØ„Å°', '9': '„Åç„ÇÖ„ÅÜ', '0': ''
        };
        const singleDigitKanji = {
            '0': 'Èõ∂', '1': '‰∏Ä', '2': '‰∫å', '3': '‰∏â', '4': 'Âõõ', '5': '‰∫î', '6': 'ÂÖ≠', '7': '‰∏É', '8': 'ÂÖ´', '9': '‰πù'
        };

        function numToJapaneseSimple(num_to_convert) {
            if (num_to_convert === 0) return { kanji: "", reading: "" };
            if (num_to_convert > 9999 || num_to_convert < 0) {
                 console.warn("numToJapaneseSimple called with number out of 0-9999 range:", num_to_convert);
                 return {kanji: String(num_to_convert), reading: String(num_to_convert)};
            }
            let n = num_to_convert;
            let k = "";
            let r = "";
            if (n >= 1000) {
                const thousands = Math.floor(n / 1000);
                if (thousands === 1) { k += "ÂçÉ"; r += "„Åõ„Çì"; }
                else {
                    k += (singleDigitKanji[String(thousands)] || String(thousands)) + "ÂçÉ";
                    if (thousands === 3) r += "„Åï„Çì„Åú„Çì";
                    else if (thousands === 8) r += "„ÅØ„Å£„Åõ„Çì";
                    else r += (singleDigitReadings[String(thousands)] || String(thousands)) + "„Åõ„Çì";
                }
                n %= 1000;
            }
            if (n >= 100) {
                const hundreds = Math.floor(n / 100);
                if (hundreds === 1) { k += "Áôæ"; r += "„Å≤„ÇÉ„Åè"; }
                else {
                    k += (singleDigitKanji[String(hundreds)] || String(hundreds)) + "Áôæ";
                    if (hundreds === 3) r += "„Åï„Çì„Å≥„ÇÉ„Åè";
                    else if (hundreds === 6) r += "„Çç„Å£„Å¥„ÇÉ„Åè";
                    else if (hundreds === 8) r += "„ÅØ„Å£„Å¥„ÇÉ„Åè";
                    else r += (singleDigitReadings[String(hundreds)] || String(hundreds)) + "„Å≤„ÇÉ„Åè";
                }
                n %= 100;
            }
            if (n >= 10) {
                const tens = Math.floor(n / 10);
                if (tens === 1) { k += "ÂçÅ"; r += "„Åò„ÇÖ„ÅÜ"; }
                else {
                    k += (singleDigitKanji[String(tens)] || String(tens)) + "ÂçÅ";
                    r += (singleDigitReadings[String(tens)] || String(tens)) + "„Åò„ÇÖ„ÅÜ";
                }
                n %= 10;
            }
            if (n > 0) {
                k += singleDigitKanji[String(n)] || String(n);
                r += singleDigitReadings[String(n)] || String(n);
            }
            return { kanji: k, reading: r };
        }

        function numToJapanese(num_orig) {
            if (num_orig === 0) return { kanji: "Èõ∂", reading: "„Çå„ÅÑ" };
            if (num_orig > 99999999 || num_orig < 0) {
                 console.warn("numToJapanese called with number out of reasonable range:", num_orig);
                 return {kanji: String(num_orig) + " (ËΩ¨Êç¢Ë∂ÖÂá∫ËåÉÂõ¥)", reading: String(num_orig) + " (ËΩ¨Êç¢Ë∂ÖÂá∫ËåÉÂõ¥)"};
            }
            let num = num_orig;
            let k = "";
            let r = "";
            if (num >= 10000) {
                const manVal = Math.floor(num / 10000);
                const manParts = numToJapaneseSimple(manVal);
                k += manParts.kanji + "‰∏á";
                r += manParts.reading + "„Åæ„Çì";
                num %= 10000;
                if (num === 0) return { kanji: k, reading: r };
            }
            if (num > 0 || k === "") {
                const restParts = numToJapaneseSimple(num);
                k += restParts.kanji;
                r += restParts.reading;
            }
            if (k === "" && r === "" && num_orig > 0) {
                 console.error("Failed to convert positive number:", num_orig);
                 return {kanji: String(num_orig), reading: String(num_orig)};
            }
            return { kanji: k, reading: r };
        }

        const quizData = [
            { type: 'standalone_number', unit: 'Áôæ', values: [
                { num: 100, q: 'Áôæ', a: '„Å≤„ÇÉ„Åè' }, { num: 200, q: '‰∫åÁôæ', a: '„Å´„Å≤„ÇÉ„Åè' },
                { num: 300, q: '‰∏âÁôæ', a: '„Åï„Çì„Å≥„ÇÉ„Åè' }, { num: 400, q: 'ÂõõÁôæ', a: '„Çà„Çì„Å≤„ÇÉ„Åè' },
                { num: 500, q: '‰∫îÁôæ', a: '„Åî„Å≤„ÇÉ„Åè' }, { num: 600, q: 'ÂÖ≠Áôæ', a: '„Çç„Å£„Å¥„ÇÉ„Åè' },
                { num: 700, q: '‰∏ÉÁôæ', a: '„Å™„Å™„Å≤„ÇÉ„Åè' }, { num: 800, q: 'ÂÖ´Áôæ', a: '„ÅØ„Å£„Å¥„ÇÉ„Åè' },
                { num: 900, q: '‰πùÁôæ', a: '„Åç„ÇÖ„ÅÜ„Å≤„ÇÉ„Åè' }
            ]},
            { type: 'standalone_number', unit: 'ÂçÉ', values: [
                { num: 1000, q: 'ÂçÉ', a: '„Åõ„Çì' }, { num: 2000, q: '‰∫åÂçÉ', a: '„Å´„Åõ„Çì' },
                { num: 3000, q: '‰∏âÂçÉ', a: '„Åï„Çì„Åú„Çì' }, { num: 4000, q: 'ÂõõÂçÉ', a: '„Çà„Çì„Åõ„Çì' },
                { num: 5000, q: '‰∫îÂçÉ', a: '„Åî„Åõ„Çì' }, { num: 6000, q: 'ÂÖ≠ÂçÉ', a: '„Çç„Åè„Åõ„Çì' },
                { num: 7000, q: '‰∏ÉÂçÉ', a: '„Å™„Å™„Åõ„Çì' }, { num: 8000, q: 'ÂÖ´ÂçÉ', a: '„ÅØ„Å£„Åõ„Çì' },
                { num: 9000, q: '‰πùÂçÉ', a: '„Åç„ÇÖ„ÅÜ„Åõ„Çì' }
            ]},
            {
                type: 'complex_number',
                displayName: 'Â§çÊùÇÊï∞Â≠ó',
                range: [101, 99999],
                generator: function() { // Removed unused parameter
                    let num;
                    do {
                        num = getRandomInt(this.range[0], this.range[1]);
                    } while (
                        (num < 1000 && num % 100 === 0) ||
                        (num < 10000 && num % 1000 === 0)
                    );
                    const japaneseParts = numToJapanese(num);
                    return {
                        q: String(num),
                        a: japaneseParts.reading,
                        kanji_representation: japaneseParts.kanji
                    };
                }
            },
            { type: 'number_counter_list', counterKanji: 'Êúà', items: [
                { num: 1, numKanji: '‰∏Ä', qSuffix: 'Êúà', a: '„ÅÑ„Å°„Åå„Å§' }, { num: 2, numKanji: '‰∫å', qSuffix: 'Êúà', a: '„Å´„Åå„Å§' },
                { num: 3, numKanji: '‰∏â', qSuffix: 'Êúà', a: '„Åï„Çì„Åå„Å§' }, { num: 4, numKanji: 'Âõõ', qSuffix: 'Êúà', a: '„Åó„Åå„Å§' },
                { num: 5, numKanji: '‰∫î', qSuffix: 'Êúà', a: '„Åî„Åå„Å§' }, { num: 6, numKanji: 'ÂÖ≠', qSuffix: 'Êúà', a: '„Çç„Åè„Åå„Å§' },
                { num: 7, numKanji: '‰∏É', qSuffix: 'Êúà', a: '„Åó„Å°„Åå„Å§' }, { num: 8, numKanji: 'ÂÖ´', qSuffix: 'Êúà', a: '„ÅØ„Å°„Åå„Å§' },
                { num: 9, numKanji: '‰πù', qSuffix: 'Êúà', a: '„Åè„Åå„Å§' }, { num: 10, numKanji: 'ÂçÅ', qSuffix: 'Êúà', a: '„Åò„ÇÖ„ÅÜ„Åå„Å§' },
                { num: 11, numKanji: 'ÂçÅ‰∏Ä', qSuffix: 'Êúà', a: '„Åò„ÇÖ„ÅÜ„ÅÑ„Å°„Åå„Å§' }, { num: 12, numKanji: 'ÂçÅ‰∫å', qSuffix: 'Êúà', a: '„Åò„ÇÖ„ÅÜ„Å´„Åå„Å§' }
            ]},
            { type: 'number_counter_list', counterKanji: 'Êó•', items: [
                { num: 1, numKanji: '‰∏Ä', qSuffix: 'Êó•', a: '„Å§„ÅÑ„Åü„Å°' }, { num: 2, numKanji: '‰∫å', qSuffix: 'Êó•', a: '„Åµ„Å§„Åã' },
                { num: 3, numKanji: '‰∏â', qSuffix: 'Êó•', a: '„Åø„Å£„Åã' }, { num: 4, numKanji: 'Âõõ', qSuffix: 'Êó•', a: '„Çà„Å£„Åã' },
                { num: 5, numKanji: '‰∫î', qSuffix: 'Êó•', a: '„ÅÑ„Å§„Åã' }, { num: 6, numKanji: 'ÂÖ≠', qSuffix: 'Êó•', a: '„ÇÄ„ÅÑ„Åã' },
                { num: 7, numKanji: '‰∏É', qSuffix: 'Êó•', a: '„Å™„ÅÆ„Åã' }, { num: 8, numKanji: 'ÂÖ´', qSuffix: 'Êó•', a: '„Çà„ÅÜ„Åã' },
                { num: 9, numKanji: '‰πù', qSuffix: 'Êó•', a: '„Åì„Åì„ÅÆ„Åã' }, { num: 10, numKanji: 'ÂçÅ', qSuffix: 'Êó•', a: '„Å®„Åä„Åã' },
                { num: 11, numKanji: 'ÂçÅ‰∏Ä', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„ÅÑ„Å°„Å´„Å°'}, {num: 12, numKanji: 'ÂçÅ‰∫å', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„Å´„Å´„Å°'},
                { num: 13, numKanji: 'ÂçÅ‰∏â', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„Åï„Çì„Å´„Å°'}, { num: 14, numKanji: 'ÂçÅÂõõ', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„Çà„Å£„Åã' },
                {num: 15, numKanji: 'ÂçÅ‰∫î', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„Åî„Å´„Å°'}, { num: 16, numKanji: 'ÂçÅÂÖ≠', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„Çç„Åè„Å´„Å°'},
                {num: 17, numKanji: 'ÂçÅ‰∏É', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„Åó„Å°„Å´„Å°'}, {num: 18, numKanji: 'ÂçÅÂÖ´', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„ÅØ„Å°„Å´„Å°'},
                {num: 19, numKanji: 'ÂçÅ‰πù', qSuffix: 'Êó•', a: '„Åò„ÇÖ„ÅÜ„Åè„Å´„Å°'}, { num: 20, numKanji: '‰∫åÂçÅ', qSuffix: 'Êó•', a: '„ÅØ„Å§„Åã' },
                { num: 21, numKanji: '‰∫åÂçÅ‰∏Ä', qSuffix: 'Êó•', a: '„Å´„Åò„ÇÖ„ÅÜ„ÅÑ„Å°„Å´„Å°'}, { num: 24, numKanji: '‰∫åÂçÅÂõõ', qSuffix: 'Êó•', a: '„Å´„Åò„ÇÖ„ÅÜ„Çà„Å£„Åã' }
            ]},
            { type: 'number_counter_generated', counterKanji: 'ÊôÇ', range: [1, 12], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 4) answerReading = '„Çà„Åò';
                else if (num === 7) answerReading = '„Åó„Å°„Åò';
                else if (num === 9) answerReading = '„Åè„Åò';
                else answerReading = readingNumPart + '„Åò';
                return { q: kanjiNumPart + 'ÊôÇ', a: answerReading };
            }},
            { type: 'number_counter_generated', counterKanji: 'ÂàÜ', range: [1, 59], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                const lastDigit = num % 10;

                if (num === 1) answerReading = '„ÅÑ„Å£„Å∑„Çì';
                else if (num === 3 || (num > 10 && lastDigit === 3)) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['3'].length) + '„Åï„Çì„Å∑„Çì';
                else if (num === 4 || (num > 10 && lastDigit === 4)) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['4'].length) + '„Çà„Çì„Å∑„Çì';
                else if (num === 6 || (num > 10 && lastDigit === 6)) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['6'].length) + '„Çç„Å£„Å∑„Çì';
                else if (num === 8 || (num > 10 && lastDigit === 8)) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['8'].length) + '„ÅØ„Å£„Å∑„Çì';
                else if (num % 10 === 0) { // 10, 20, 30, 40, 50
                    if (num === 10) answerReading = '„Åò„ÇÖ„Å£„Å∑„Çì';
                    else answerReading = readingNumPart.slice(0, -3) + '„Å£„Å∑„Çì'; // e.g., „Å´„Åò„ÇÖ„ÅÜ -> „Å´„Åò + „Å£„Å∑„Çì
                }
                // For combined numbers like 11ÂàÜ, 21ÂàÜ
                else if (num > 10 && lastDigit === 1) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['1'].length) + '„ÅÑ„Å£„Å∑„Çì';
                else answerReading = readingNumPart + '„Åµ„Çì';

                // Specific overrides for very common cases or tricky ones
                if (num === 10) answerReading = '„Åò„ÇÖ„Å£„Å∑„Çì'; // or „Åò„Å£„Å∑„Çì
                if (num === 20) answerReading = '„Å´„Åò„Å£„Å∑„Çì'; // or „Å´„Åò„ÇÖ„Å£„Å∑„Çì
                if (num === 30) answerReading = '„Åï„Çì„Åò„Å£„Å∑„Çì';
                if (num === 40) answerReading = '„Çà„Çì„Åò„Å£„Å∑„Çì';
                if (num === 50) answerReading = '„Åî„Åò„Å£„Å∑„Çì';

                return { q: kanjiNumPart + 'ÂàÜ', a: answerReading };
            }},
            { type: 'number_counter_generated', counterKanji: 'Âõû', range: [1, 20], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1) answerReading = '„ÅÑ„Å£„Åã„ÅÑ';
                else if (num === 6) answerReading = '„Çç„Å£„Åã„ÅÑ';
                else if (num === 8) answerReading = '„ÅØ„Å£„Åã„ÅÑ';
                else if (num === 10) answerReading = '„Åò„Å£„Åã„ÅÑ';
                else if (num > 10 && num % 10 === 1) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['1'].length) + '„ÅÑ„Å£„Åã„ÅÑ';
                else if (num > 10 && num % 10 === 6) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['6'].length) + '„Çç„Å£„Åã„ÅÑ';
                else if (num > 10 && num % 10 === 8) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['8'].length) + '„ÅØ„Å£„Åã„ÅÑ';
                else if (num > 10 && num % 10 === 0) answerReading = readingNumPart.slice(0,-3) + '„Å£„Åã„ÅÑ';
                else answerReading = readingNumPart + '„Åã„ÅÑ';
                return { q: kanjiNumPart + 'Âõû', a: answerReading };
            }},
            { type: 'number_counter_generated', counterKanji: 'ÂÜä', range: [1, 20], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1) answerReading = '„ÅÑ„Å£„Åï„Å§';
                else if (num === 8) answerReading = '„ÅØ„Å£„Åï„Å§';
                else if (num === 10) answerReading = '„Åò„Å£„Åï„Å§';
                else if (num > 10 && num % 10 === 1) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['1'].length) + '„ÅÑ„Å£„Åï„Å§';
                else if (num > 10 && num % 10 === 8) answerReading = readingNumPart.slice(0, readingNumPart.length - singleDigitReadings['8'].length) + '„ÅØ„Å£„Åï„Å§';
                else if (num > 10 && num % 10 === 0) answerReading = readingNumPart.slice(0,-3) + '„Å£„Åï„Å§';
                else answerReading = readingNumPart + '„Åï„Å§';
                return { q: kanjiNumPart + 'ÂÜä', a: answerReading };
            }},
            { type: 'number_counter_generated', counterKanji: 'ÁùÄ', range: [1, 10], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1) answerReading = '„ÅÑ„Å£„Å°„ÇÉ„Åè';
                else if (num === 8) answerReading = '„ÅØ„Å£„Å°„ÇÉ„Åè';
                else if (num === 10) answerReading = '„Åò„Å£„Å°„ÇÉ„Åè';
                else answerReading = readingNumPart + '„Å°„ÇÉ„Åè';
                return { q: kanjiNumPart + 'ÁùÄ', a: answerReading };
            }},
            { type: 'number_counter_generated', counterKanji: 'Êûö', range: [1, 20], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                return { q: kanjiNumPart + 'Êûö', a: readingNumPart + '„Åæ„ÅÑ' };
            }},
            { type: 'number_counter_generated', counterKanji: '‰∫∫', range: [1, 10], generator: (num) => {
                const { kanji: kanjiNumPart, reading: readingNumPart } = numToJapaneseSimple(num);
                let answerReading = '';
                if (num === 1) answerReading = '„Å≤„Å®„Çä';
                else if (num === 2) answerReading = '„Åµ„Åü„Çä';
                else if (num === 4) answerReading = '„Çà„Å´„Çì';
                else answerReading = readingNumPart + '„Å´„Çì';
                return { q: kanjiNumPart + '‰∫∫', a: answerReading };
            }},
        ];

        const questionArea = document.getElementById('questionArea');
        const answerInput = document.getElementById('answerInput'); // Renamed from answerInputElement for consistency
        const checkButton = document.getElementById('checkButton'); // Renamed
        const nextButton = document.getElementById('nextButton'); // Renamed
        const feedbackArea = document.getElementById('feedbackArea');
        const scoreDisplay = document.getElementById('score');

        let currentQuestionData = null;
        let score = 0;

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generateQuestion() {
            answerInput.value = '';
            feedbackArea.textContent = '';
            feedbackArea.className = '';
            answerInput.disabled = false;
            checkButton.disabled = false;

            const categoryIndex = getRandomInt(0, quizData.length - 1);
            const category = quizData[categoryIndex];

            if (category.type === 'standalone_number' || category.type === 'number_counter_list') {
                const itemsArray = category.values || category.items;
                const itemIndex = getRandomInt(0, itemsArray.length - 1);
                const item = itemsArray[itemIndex];
                currentQuestionData = { q: item.q, a: item.a, type: category.type };
                 if (category.type === 'number_counter_list') {
                    currentQuestionData.q = item.numKanji + item.qSuffix;
                }
            } else if (category.type === 'number_counter_generated' || category.type === 'complex_number') {
                const numForGenerator = (category.type === 'complex_number') ? null : getRandomInt(category.range[0], category.range[1]);
                currentQuestionData = category.generator(numForGenerator); // Pass numForGenerator
                currentQuestionData.type = category.type;
            }
            questionArea.textContent = currentQuestionData.q;
        }

        function checkAnswer() {
            const userAnswer = answerInput.value.trim().replace(/„Çî/g, '„ÅÜ„Çõ');
            const strings = uiStrings[currentLanguage]; // Get strings for the current language

            if (!userAnswer) {
                feedbackArea.textContent = strings.inputPrompt;
                feedbackArea.className = 'incorrect';
                return;
            }

            if (userAnswer === currentQuestionData.a) {
                feedbackArea.textContent = strings.correctFeedback;
                if (currentQuestionData.type === 'complex_number' && currentQuestionData.kanji_representation) {
                    feedbackArea.textContent += ` (${currentQuestionData.kanji_representation})`;
                }
                feedbackArea.className = 'correct';
                score++;
                scoreDisplay.textContent = score;
            } else {
                let correctAnswerText = `${strings.incorrectFeedbackPrefix}${currentQuestionData.a}`;
                if (currentQuestionData.type === 'complex_number' && currentQuestionData.kanji_representation) {
                    correctAnswerText += ` ( ${currentQuestionData.kanji_representation} )`;
                }
                feedbackArea.textContent = correctAnswerText;
                feedbackArea.className = 'incorrect';
            }
            answerInput.disabled = true;
            checkButton.disabled = true;
        }

        checkButton.addEventListener('click', checkAnswer);
        nextButton.addEventListener('click', generateQuestion);
        answerInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                if (!checkButton.disabled) {
                     checkAnswer();
                } else {
                    generateQuestion();
                }
            }
        });

        // --- Initial Load ---
        setInitialLanguage(); // Set language based on browser settings first
        generateQuestion(); // Then generate the first question
    </script>
</body>
</html>
ÔøΩ
